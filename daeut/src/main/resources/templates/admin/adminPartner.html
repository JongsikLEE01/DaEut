<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/layout/admin_layout}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Da E ut</title>
</head>

<body layout:fragment="content">
    <div class="container-fluid container">
        <button class="btn btn-primary toggle-btn menu mt-2 myBtn d-md-none transitionNone" id="toggle-btn" onclick="toggleSidebar()">메뉴</button>
        
        <div class="row">
            <!-- 사이드바 -->
            <nav class="col-md-3 col-lg-2 sidebar" id="sidebar">
                <button class="btn btn-danger d-block d-md-none cancel mb-3" onclick="toggleSidebar()">닫기</button>
                <h5>관리</h5>
                <hr>
                <a href="/admin/adminUser">회원 관리</a>
                <a href="/admin/adminPartner">파트너 관리</a>
                <a href="/admin/adminReservation">예약 관리</a>
            </nav>
            <!-- 컨텐츠 영역 -->
            <div class="col-md-9 col-lg-10">
                <h3 class="mt-5 ml-5 mb-5 color_main">파트너 관리</h3>
                <table class="table table-sm mb-5 table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>No.</th>
                            <th>파트너</th>
                            <th>주소</th>
                            <th>경력</th>
                            <th>등록 일자</th>
                            <th>승인 상태</th>
                            <th><input type="checkbox" id="selectAll" class="checkbox"></th>
                        </tr>
                    </thead>
                    <tbody id="partnerList">
                        <!-- 리스트 항목 추가 -->
                    </tbody>
                </table>
                <div class="d-flex justify-content-end mb-5 gap-3">
                    <button class="btn btn-danger cancel" onclick="deleteSelected()">선택 삭제</button>
                    <button class="btn btn-danger cancel" onclick="deleteAll()">전체 삭제</button>
                </div>
                <div class="pagination">
                    <a href="#">&laquo;</a>
                    <a href="#">&lt;</a>
                    <a href="#" th:classappend="${page == 1} ? 'active'">1</a>
                    <a href="#">2</a>
                    <a href="#">3</a>
                    <a href="#">4</a>
                    <a href="#">5</a>
                    <a href="#">&gt;</a>
                    <a href="#">&raquo;</a>
                </div>
            </div>

        </div><!-- .row end -->
    </div>


    <script>
        const partners = [
            // TODO : 파트너 데이터 연결 필요
            {
                no: 1,
                name: "박은서",
                address: "인천광역시 부평구",
                experience: "특수 청소 3년",
                date: "2024-05-20 12:19:10",
                status: "대기"
            },
            {
                no: 2,
                name: "전나연",
                address: "인천광역시 부평구",
                experience: "일반 청소 3년",
                date: "2024-05-20 12:19:10",
                status: "승인"
            },
            {
                no: 3,
                name: "윤준호",
                address: "인천광역시 부평구",
                experience: "특수 청소 3년",
                date: "2024-05-20 12:19:10",
                status: "취소"
            },
            {
                no: 4,
                name: "박은서",
                address: "인천광역시 부평구",
                experience: "특수 청소 3년",
                date: "2024-05-20 12:19:10",
                status: "대기"
            },
            {
                no: 5,
                name: "전나연",
                address: "인천광역시 부평구",
                experience: "일반 청소 3년",
                date: "2024-05-20 12:19:10",
                status: "승인"
            },
            {
                no: 6,
                name: "윤준호",
                address: "인천광역시 부평구",
                experience: "특수 청소 3년",
                date: "2024-05-20 12:19:10",
                status: "취소"
            },
            {
                no: 7,
                name: "박은서",
                address: "인천광역시 부평구",
                experience: "특수 청소 3년",
                date: "2024-05-20 12:19:10",
                status: "대기"
            },
            {
                no: 8,
                name: "전나연",
                address: "인천광역시 부평구",
                experience: "일반 청소 3년",
                date: "2024-05-20 12:19:10",
                status: "승인"
            },
            {
                no: 9,
                name: "윤준호",
                address: "인천광역시 부평구",
                experience: "특수 청소 3년",
                date: "2024-05-20 12:19:10",
                status: "취소"
            },
            {
                no: 10,
                name: "윤준호",
                address: "인천광역시 부평구",
                experience: "특수 청소 3년",
                date: "2024-05-20 12:19:10",
                status: "취소"
            }
        ];

        // 페이지 변수
        const itemsPerPage = 10;
        let currentPage = 1;

        function renderTable() {
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedItems = partners.slice(start, end);

            const tableBody = document.getElementById("partnerList");
            tableBody.innerHTML = "";

            // a태그 안에 조회로 이동할 수 있게해야함
            paginatedItems.forEach((partner, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                <td>${partner.no}</td>
                <td><a href="/admin/adminPartnerRead?no=${partner.no}">${partner.name}</a></td>
                <td>${partner.address}</td>
                <td>${partner.experience}</td>
                <td>${partner.date}</td>
                <td>${partner.status}</td>
                <td><input type="checkbox" class="selectBox"></td>
                `;
                tableBody.appendChild(row);
            });
        }

        // TODO : 페이징 처리 필요
        // function prevPage() {
        //     if (currentPage > 1) {
        //         currentPage--;
        //         renderTable();
        //     }
        // }

        // function nextPage() {
        //     if (currentPage * itemsPerPage < partners.length) {
        //         currentPage++;
        //         renderTable();
        //     }
        // }

        // TODO : DB 삭제 필요
        function deleteSelected() {
            const selectedBoxes = document.querySelectorAll(".selectBox:checked");
            selectedBoxes.forEach(box => {
                const row = box.closest("tr");
                const no = parseInt(row.children[1].innerText);
                const index = partners.findIndex(partner => partner.no === no);
                if (index !== -1) {
                    partners.splice(index, 1);
                }
            });
            renderTable();
        }

        // TODO : DB 삭제 필요
        function deleteAll() {
            partners.length = 0;
            renderTable();
        }

        document.getElementById("selectAll").addEventListener("change", function () {
            const selectBoxes = document.querySelectorAll(".selectBox");
            selectBoxes.forEach(box => {
                box.checked = this.checked;
            });
        });

        renderTable();
    </script>
</body>

</html>